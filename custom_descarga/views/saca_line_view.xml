<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <record id="saca_line_form_view" model="ir.ui.view">
        <field name="model">saca.line</field>
        <field name="inherit_id" ref="custom_saca_purchase.saca_line_form_view"/>
        <field name="arch" type="xml">
            <button name="action_create_purchase" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('purchase_order_id','!=',False), ('is_canceled', '!=', False)]}</attribute>
            </button>
            <field name="seq" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="external_supplier" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="breeding_id" position="attributes">
                <attribute name="attrs">{'invisible': [('external_supplier','=',True)], 'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="supplier_id" position="attributes">
                <attribute name="attrs">{'readonly':['|', ('external_supplier', '=', False), ('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="farmer_id" position="attributes">
                <attribute name="attrs">{'readonly':['|', ('external_supplier', '=', False), ('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="farm_id" position="attributes">
                <attribute name="attrs">{'readonly':['|', ('external_supplier', '=', False), ('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="existence" position="attributes">
                <attribute name="attrs">{'invisible': [('external_supplier','=',True)], 'readonly':[('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="age" position="attributes">
                <attribute name="attrs">{'invisible': [('external_supplier','=',True)], 'readonly':[('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="main_scale" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="driver_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="vehicle_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="remolque_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="estimate_burden" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="unit_burden" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="estimate_weight" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="coya_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="burden_type" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="cleaned_date" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="disinfectant_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="saca_time" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="cleaned_time" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="fasting" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="cleaning_seal_number" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="purchase_order_line_ids" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <field name="product_id" position="attributes">
                <attribute name="attrs">{'readonly': [('is_canceled', '=', True)]}</attribute>
            </field>
            <header position="inside">
                <field name="is_canceled" invisible="1"/>
                <button name="action_next_stage" type="object" string="Next Stage" class="oe_highlight" attrs="{'invisible': ['|', ('purchase_order_id','=',False), ('is_canceled', '=', True)]}"/>
            </header>
            <notebook position="inside">
                <page name="descarga" string="Descarga">
                    <group string="Descarga information">
                        <group>
                            <field name="currency_id" invisible="1"/>
                            <field name="guide_number" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="download_unit" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="forklift" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="distance_done" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                        </group>
                        <group>
                            <field name="torista_id" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="staff" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="crew" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                        </group>
                        <group>
                        </group>
                    </group>
                    <group col="3">
                        <group string="Farm">
                            <field name="gross_origin" string="Gross" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="tara_origin" string="Tara" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="net_origin" string="Net"/>
                            <field name="average_weight_origin" string="Average Weight"/>
                        </group>
                        <group string="Slaughterhouse">
                            <field name="gross_dest" string="Gross" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="tara_dest" string="Tara" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="net_dest" string="Net"/>
                            <field name="average_weight_dest" string="Average Weight"/>
                        </group>
                        <group string="Difference">
                            <field name="dif_gross" string="Gross"/>
                            <field name="dif_tara" string="Tara"/>
                            <field name="dif_net" string="Net"/>
                            <field name="dif_average_weight" string="Average Weight"/>
                        </group>
                    </group>
                    <group string="Operations" col="1">
                        <field name="stock_move_ids" nolabel="1" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                    </group>
                    <group string="Detailed operations" col="1">
                        <field name="move_line_ids" nolabel="1" context="{'tree_view_ref': 'stock_picking_batch.view_move_line_tree'}" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                    </group>
                </page>
                <page name="killing" string="Killing/Classified" attrs="{'readonly': [('is_canceled', '=', True)]}">
                    <group string="Information Killing">
                        <group>
                            <field name="killing_staff" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <label for="craw"/>
                            <div class="o_row" name="craw">
                                <field name="craw" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                                <field name="weight_uom_name" readonly="1"/>
                            </div>
                            <label for="kilo_discount"/>
                            <div class="o_row" name="kilo_discount">
                                <field name="kilo_discount" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                                <span>%</span>
                            </div>
                            <field name="total_cost" widget='monetary' options="{'currency_field': 'currency_id'}" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="priority" widget="priority" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            <field name="clasification" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                        </group>
                        <group>
                            <field name="origin_qty"/>
                            <field name="dest_qty"/>
                            <field name="purchase_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="purchase_unit_price" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                    </group>
                    <group col="3">
                        <group string="Slaughterers">
                            <field name="slaughterer_ids" nolabel="1" attrs="{'readonly': [('is_canceled', '=', True)]}">
                                <tree editable="bottom" nolabel="1">
                                    <field name="name" readonly="1"/>
                                </tree>
                            </field>
                        </group>
                        <group string="Hangers">
                            <field name="hanger_ids" nolabel="1" attrs="{'readonly': [('is_canceled', '=', True)]}">
                                <tree editable="bottom" nolabel="1">
                                    <field name="name" readonly="1"/>
                                </tree>
                            </field>
                        </group>
                        <group string="Forklift Operators">
                            <field name="forklift_operator_ids" nolabel="1" attrs="{'readonly': [('is_canceled', '=', True)]}">
                                <tree nolabel="1">
                                    <field name="name" readonly="1"/>
                                </tree>
                            </field>
                        </group>
                    </group>
                </page>
                <page name="quartering" string="Quartering">
                    <group>
                        <group>
                            <field name="channel_temperature" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                        </group>
                        <group>
                            <label for="waiting_reason"/>
                            <div class="o_row" name="waiting_time">
                                <field name="waiting_reason" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                                <field name="waiting_time" widget="float_time" attrs="{'readonly': [('is_canceled', '=', True)]}"/>
                            </div>
                    </group>
                    </group>
                </page>
            </notebook>
        </field>
    </record>

    <record id="saca_line_tree_view" model="ir.ui.view">
        <field name="model">saca.line</field>
        <field name="inherit_id" ref="custom_saca.saca_line_tree_view"/>
        <field name="arch" type="xml">
            <field name="price_unit" position="before">
                <field name="net_origin" string="Net"/>
            </field>
            <field name="note" position="after">
                <field name="color_name" invisible="1"/>
                <field name="stage_id" widget="badge" decoration-success="color_name == 'green'" decoration-info="color_name == 'blue'" 
                decoration-danger="color_name == 'red'" decoration-warning="color_name == 'yellow'" decoration-primary="color_name == 'purple'"/>
                <field name="is_canceled" invisible="1"/>
            </field>
            <tree position="attributes">
                <attribute name="decoration-muted">is_canceled == True</attribute>
            </tree>
        </field>
    </record>

    <record id="saca_line_view_search" model="ir.ui.view">
        <field name="model">saca.line</field>
        <field name="inherit_id" ref="custom_saca.saca_line_view_search"/>
        <field name="arch" type="xml">
            <field name="saca_id" position="after">
                <field name="stage_id"/>
            </field>
            <filter name="saca" position="after">
                <filter string="Stage" name="stage" context="{'group_by':'stage_id'}"/>
            </filter>
        </field>
    </record>

    <record id="action_cancel_saca_line" model="ir.actions.server">
        <field name="name">Cancel</field>
        <field name="model_id" ref="custom_descarga.model_saca_line"/>
        <field name="binding_model_id" ref="custom_descarga.model_saca_line"/>
        <field name="state">code</field>
        <field name="code">
            for record in records:
                record.action_cancel()
        </field>
    </record>
</odoo>

<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_repairorder_inh_intecpla" inherit_id="repair.report_repairorder">
        <t t-call="web.external_layout" position="attributes">
            <attribute name="t-call">intecpla_reports.external_layout_mrp</attribute>
        </t>

        <t t-set="address" position="replace">
            <t t-set="address">
                <br/>
                <br/>
                <div>
                    <strong t-field="o.partner_id.name"/>
                </div>
                <span t-field="o.partner_id.street" />
                <br/>
                <span t-field="o.partner_id.zip" />
                <span t-field="o.partner_id.city" />
                <span t-esc="o.partner_id.get_state_name()"/>
                <br/>
                <span t-field="o.partner_id.country_id.name" />
            </t>
        </t>
        <xpath expr='//t[@t-set="information_block"]' position="replace">
            <t t-set="information_block">
                <div>
                    <strong t-field="o.company_id.partner_id.name"/>
                </div>
                VAT: <span t-field="o.company_id.partner_id.vat" />
                <br/>
                <span t-field="o.company_id.partner_id.street" />
                <br/>
                <span t-field="o.company_id.partner_id.zip" />
                <span t-field="o.company_id.partner_id.city" />
                <span t-esc="o.company_id.partner_id.get_state_name()"/>
                <br/>
                <span t-field="o.company_id.partner_id.country_id.name" />
                <br/>
                Phone: <span t-field="o.company_id.partner_id.phone" />
                <br/>
                <span t-field="o.company_id.partner_id.email" />
                <br/>
                <span t-field="o.company_id.partner_id.website" />
            </t>
        </xpath>

        <h2 position="replace" />

        <t t-if="o.operations" position="replace">
            <t t-if="o.operations">
                <tr class="bg-200 o_line_section" >
                    <td colspan="5" style="font-size: 13px;">
                        <strong>Parts</strong>
                    </td>
                </tr>
                <tr t-foreach="o.operations" t-as="line">
                    <td style="font-size: 13px;">
                        <p t-if="line.type == 'add'"><i>(Add)</i>
                            <span t-if="line.product_id.name2" >
                                <span t-field="line.product_id.name2" />
                            </span>
                            <span t-if="not line.product_id.name2" >
                                <span t-field="line.name" />
                            </span>
                        </p>
                        <p t-if="line.type == 'remove'">(<i>Remove</i>)
                            <span t-if="line.product_id.name2" >
                                <span t-field="line.product_id.name2" />
                            </span>
                            <span t-if="not line.product_id.name2" >
                                <span t-field="line.name" />
                            </span>
                        </p>
                    </td>
                    <td class="text-right" style="font-size: 13px;">
                        <span t-field="line.product_uom_qty"/>
                        <span groups="uom.group_uom" t-field="line.product_uom.name"/>
                    </td>
                    <t t-if="(line.repair_id.invoice_method != 'none')">
                        <td class="text-right" style="font-size: 13px;">
                            <span t-field="line.price_unit"/>
                        </td>
                        <td class="text-center" style="font-size: 13px;">
                            <span t-esc="','.join(map( lambda x: x.name, line.tax_id))"/>
                        </td>
                        <td class="text-right o_price_total" style="font-size: 13px;">
                            <span t-field="line.price_subtotal" t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                       </td>
                    </t>
                </tr>
            </t>
        </t>
        <t t-if="o.fees_lines" position="replace">
            <t t-if="o.fees_lines">
                <tr class="bg-200 o_line_section">
                    <td colspan="5" style="font-size: 13px;">
                        <strong>Operations</strong>
                    </td>
                </tr>
                <tr t-foreach="o.fees_lines" t-as="fees">
                    <td style="font-size: 13px;">
                        <span t-field="fees.name"/>
                    </td>
                    <td class="text-right" style="font-size: 13px;">
                        <span t-field="fees.product_uom_qty"/>
                        <span groups="uom.group_uom" t-field="fees.product_uom.name"/>
                    </td>
                    <t t-if="(fees.repair_id.invoice_method != 'none')">
                        <td class="text-right" style="font-size: 13px;">
                            <span t-field="fees.price_unit"/>
                        </td>
                        <td class="text-center" style="font-size: 13px;">
                            <span t-esc="','.join(map( lambda x: x.name, fees.tax_id))"/>
                        </td>
                        <td class="text-right o_price_total" style="font-size: 13px;">
                            <span t-field="fees.price_subtotal"
                                t-options='{"widget": "monetary", "display_currency": o.pricelist_id.currency_id}'/>
                       </td>
                    </t>
                </tr>
            </t>
        </t>

    </template>
</odoo>

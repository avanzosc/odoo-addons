<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="report_front_page_inspeccion" name="Portada">
        <style>
            * {
              font-size: 12px;
            }
            .columns {
                display: -webkit-box;
                -webkit-box-orient: vertical;
                padding: 0;
            }
            .row {
                display: -webkit-box;
                -webkit-box-orient: horizontal;
                padding: 0;
            }
            div{
                padding: 2px 4px;
            }
            li{
                padding: 4px;
            }
        </style>

        <!-- PAGE NUMBER IN FOOTER -->
        <div class="footer" style="position:absolute; margin:0px; padding:0px; font-size: 12px;color: #666;">
            <span class="page"/>/<span class="topage"/>
        </div>


        <div id="front_page_container" t-att-style="'height: 990px;' if o.remove_title_from_report else 'height: 940px;'">
            <t t-if="o.remove_upper_text_from_report">
                <span style="text-align: center; font-weight: bold;">
                    <t t-if="o.building_use_id.is_industrial">
                        <h5>ACTA DE INSPECCIÓN PERIÓDICA ESTABLECIMIENTOS INDUSTRIALES</h5>
                        <h6>INSTALACIÓN DE PROTECCIÓN CONTRA INCENDIOS</h6>
                    </t>
                    <t t-else="">
                        <h5>ACTA DE INSPECCIÓN PERIÓDICA ESTABLECIMIENTOS NO INDUSTRIALES</h5>
                        <h6>INSTALACIÓN DE PROTECCIÓN CONTRA INCENDIOS</h6>
                    </t>
                </span>
                <t t-if="o.building_use_id.is_industrial">
                    <p>Okatek Servicios y Control S.L., Organismo de Control habilitado según la acreditación ENAC Nº545 / EI862, en aplicación del Artículo 6 del Reglamento de Instalaciones de Protección Contra Incendios en Establecimientos Industriales aprobado por el Real Decreto 2267/2004, de 3 de diciembre</p>
                </t>
                <t t-else="">
                    <p>Okatek Servicios y Control S.L., Organismo de Control habilitado según la acreditación ENAC Nº545 / EI862, en aplicación del Artículo 22 del Reglamento de Instalaciones de Protección Contra Incendios aprobado por el Real Decreto 513/2017,de 22 de mayo</p>
                </t>
                <p>
                    <span style="font-weight: bold;">CERTIFICA: </span> que en fecha  <span t-field="o.inspection_start_date"/>
 el inspector que suscribe el Acta  <span t-field="o.act_number"/>
   ha realizado la inspección periódica de la instalación con las siguientes características</p>
        </t>

        <!-- INICIO TABLA -->
        <div class="columns">
            <div class="row" style="border: 1px solid #ccc">
                <div style="width: 75%;">
                    <span style="font-weight: bold;">TITULAR DE LA INSTALACIÓN:  </span>
                    <span t-field="o.inspected_building_id.parent_id.name"/>
                </div>
                <div style="width: 25%; border-left: 1px solid #ccc">
                    <span style="font-weight: bold;">NIF / CIF:  </span>
                    <span t-field="o.inspected_building_id.vat"/>
                </div>
            </div>
            <div class="row" style="border: 1px solid #ccc; margin-top: -1px;">
                <div>
                    <span style="font-weight: bold;">DENOMINACIÓN DE LA INSTALACIÓN:  </span>
                    <span t-field="o.inspected_building_id.name"/>
                </div>
            </div>
            <div class="columns" style="width: 100%; margin-top: -1px; border: 1px solid #ccc;">
                <div class="row">
                    <div style="width: 20%; border-right: 1px dashed #ccc; font-weight: bold;">EMPLAZAMIENTO DE LA INSTALACIÓN:</div>
                    <div class="columns" style="width: 80%;">
                        <div class="row" style="padding: 0">
                            <div style="padding: 5px; width: 69%; border-right: 1px dashed #ccc;">DIRECCIÓN:  <span t-field="o.inspected_building_id.street"/>
                            </div>
                            <div style="padding: 5px; width: 31%;">CP.: <span t-field="o.inspected_building_id.zip"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="columns" style="width: 100%; margin-top: -1px; border: 1px solid #ccc;">
                <div class="row" style="border-bottom: 1px solid #ccc">
                    <div style="width: 20%; border-right: 1px dashed #ccc; font-weight: bold;">CARACTERÍSTICAS ESTABLECIMIENTO</div>
                    <div style="width: 80%; padding: 0;" class="column">
                        <div class="row" style="border-bottom: 1px dashed #ccc; padding: 4px 0">
                            <t t-if="o.building_section_id">

                            <div style="width: 33.33%;">
                                    USO:  <t t-if="o.building_section_id.section_use.is_industrial">INDUSTRIAL
                                    </t>
                                    <t t-else="">NO INDUSTRIAL</t>
                                </div>
                            </t>
                                <div style="width: 33.33%;">SUPERFICIE (m²): <span t-field="o.building_section_id.area"/>
                                </div>

                            <div style="width: 33.33%;">Nº PLANTAS: <span t-field="o.inspected_building_id.number_of_floors"/>
                            </div>
                        </div>

                        <!-- Field use to print the uses in the database in 2 rows -->
                        <t t-set="building_uses" t-value="request.env['building.use'].search([])"/>
                        <t t-set="use_names" t-value="building_uses.mapped('name')"/>
                        <t t-set="half_len_int" t-value="len(use_names) // 2"/>
                        <t t-set="half_len_float" t-value="len(use_names) / 2"/>

                        <t t-if="o.building_section_id">
                            <t t-if="half_len_int != half_len_float">
                                <div class="row" style="padding: 4px 0">
                                    <t t-foreach="use_names[:half_len_int + 1]" t-as="use">
                                        <div t-att-style="'width: ' + str(100 / (half_len_int + 1)) + '%;'">
                                            <t t-if="o.building_section_id.section_use.name == use">
                                                <span style="font-weight: bold; ">X</span>
                                            </t>
                                            <t t-esc="use"/>
                                        </div>
                                    </t>
                                </div>
                                <div class="row" style="border-bottom: 1px dashed #ccc; padding: 4px 0">
                                    <t t-foreach="use_names[half_len_int + 1:]" t-as="use">
                                        <div t-att-style="'width: ' + str(100 / (half_len_int + 1)) + '%;'">
                                            <t t-if="o.building_section_id.section_use.name == use">
                                                <span style="font-weight: bold; ">X</span>
                                            </t>
                                            <t t-esc="use"/>
                                        </div>
                                    </t>
                                </div>
                            </t>
                            <t t-else="">
                                <div class="row" style="padding: 4px 0">
                                    <t t-foreach="use_names[:half_len_int]" t-as="use">
                                        <div t-att-style="'width: ' + str(100 / (half_len_int)) + '%;'">
                                            <t t-if="o.building_section_id.section_use.name == use">
                                                <span style="font-weight: bold; ">X</span>
                                            </t>
                                            <t t-esc="use"/>
                                        </div>
                                    </t>
                                </div>
                                <div class="row" style="border-bottom: 1px dashed #ccc; padding: 4px 0">
                                    <t t-foreach="use_names[half_len_int:]" t-as="use">
                                        <div t-att-style="'width: ' + str(100 / half_len_int) + '%;'">
                                            <t t-if="o.building_section_id.section_use.name == use">
                                                <span style="font-weight: bold; ">X</span>
                                            </t>
                                            <t t-esc="use"/>
                                        </div>
                                    </t>
                                </div>
                            </t>

                            <div class="row" style="padding: 4px 0">
                                <div style="width: 40%;">NIVEL RIESGO INTRÍNSECO: </div>
                                <div style="padding: 0; width: 5%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.risk and 'BAJ' in str(o.building_section_id.risk)">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 15%; display: -webkit-box; -webkit-box-align: center; margin: 0; ">
                                    <span>BAJO</span>
                                </div>
                                <div style="padding: 0; width: 5%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.risk and 'MEDI' in str(o.building_section_id.risk)">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 15%; display: -webkit-box; -webkit-box-align: center; margin: 0; ">
                                    <span>MEDIA</span>
                                </div>
                                <div style="padding: 0; width: 5%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.risk and 'ALT' in str(o.building_section_id.risk)">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 15%; display: -webkit-box; -webkit-box-align: center; margin: 0; ">
                                    <span>ALTO</span>
                                </div>
                            </div>
                        </t>
                        <t t-if="o.building_section_id">
                            <div class="row" style="padding: 4px 0">
                                <div style="width: 40%;">CONFIGURACIÓN: </div>
                                <div style="padding: 0; width: 4%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.configuration=='A'">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 8%; display: -webkit-box; -webkit-box-align: center;">
                                    <span>A</span>
                                </div>
                                <div style="padding: 0; width: 4%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.configuration=='B'">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 8%; display: -webkit-box; -webkit-box-align: center;">
                                    <span>B</span>
                                </div>
                                <div style="padding: 0; width: 4%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.configuration=='C'">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 8%; display: -webkit-box; -webkit-box-align: center;">
                                    <span>C</span>
                                </div>
                                <div style="padding: 0; width: 4%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.configuration=='D'">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 8%; display: -webkit-box; -webkit-box-align: center;">
                                    <span>D</span>
                                </div>
                                <div style="padding: 0; width: 4%; display: -webkit-box; -webkit-box-align: center; -webkit-box-pack: center;">
                                    <t t-if="o.building_section_id.configuration=='E'">
                                        <span style="font-weight: bold;">X</span>
                                    </t>
                                </div>
                                <div style="padding: 0; width: 8%; display: -webkit-box; -webkit-box-align: center;">
                                    <span>E</span>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>
                <div class="columns" style="width: 100%; margin-bottom: -1px;">
                    <div class="row" style="width: 100%;">
                        <div style="width: 20%;border-right: 1px dashed #ccc;">
                            <span style="font-weight: bold;">DOCUMENTACIÓN TÉCNICA</span>
                        </div>
                        <div class="columns" style="width: 80%; margin: 0 auto 0 0; ">
                            <div class="row">
                                <div style="width: 20%; border-bottom: 1px dashed #ccc; border-right: 1px dashed #ccc;">Proyecto</div>
                                <div style="width: 80%; border-bottom: 1px dashed #ccc; ">
                                    <div class="columns">
                                        <div style="width: 100%;">
                                            <span style="font-weight: bold;">Título: </span>
                                            <span t-field="o.project_title"/>
                                        </div>
                                        <div class="row">
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Autor: </span>
                                                <span t-field="o.project_author_id"/>
                                            </div>
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Titulación: </span>
                                                <span t-field="o.project_author_degree"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Colegiado N.º: </span>
                                                <span t-field="o.project_author_license"/>
                                            </div>
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Fecha / N.º  </span>
                                                <span t-field="o.project_approved_date"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="border-bottom: 1px dashed #ccc;">
                                <div style="width: 20%; border-right: 1px dashed #ccc;">Certificado Final</div>
                                <div style="width: 80%;">
                                    <div class="columns">
                                        <div class="row">
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Autor: </span>
                                                <span t-field="o.dof_author_id"/>
                                            </div>
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Titulación: </span>
                                                <span t-field="o.dof_author_degree"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Colegiado N.º: </span>
                                                <span t-field="o.dof_author_license"/>
                                            </div>
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Fecha / N.º Visado:  </span>
                                                <span t-field="o.dof_approved_date"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div style="width: 20%; border-bottom: 1px dashed #ccc; border-right: 1px dashed #ccc;">Certificado Instalador</div>
                                <div style="width: 80%; border-bottom: 1px dashed #ccc;">
                                    <div class="columns">
                                        <div class="row">
                                            <div style="width: 100%;">
                                                <span style="font-weight: bold;"> Empresa:  </span>
                                                <span t-field="o.installer_id"/>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> EPI:  </span>
                                                <span t-field="o.installer_epi"/>
                                            </div>
                                            <div style="width: 50%;">
                                                <span style="font-weight: bold;"> Fecha:  </span>
                                                <span t-field="o.certification_date"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="border: 1px solid #ccc; margin-top: -1px; ">
                <div style="width: 20%; border-right: 1px dashed #ccc;">
                    <span style="font-weight: bold;">REGLAMENTO APLICABLE:  </span>
                </div>
                <t t-set="found_normative_filter" t-value="False"/>
                <t t-foreach="o.survey_id.question_and_page_ids" t-as="question">
                    <t t-if="question.is_normative_filter and not found_normative_filter">
                        <t t-set="all_normatives" t-value="request.env['survey.question.normative'].search([])"/>
                        <t t-set="building_date" t-value="o.inspected_building_id.service_start_date"/>
                        <t t-set="selected_answers" t-value="[]"/>

                        <t t-foreach="question.suggested_answer_ids" t-as="answer">
                            <t t-set="answer_found" t-value="False"/>
                            <t t-foreach="all_normatives" t-as="normative">
                                <t t-if="normative.start_date &lt;= building_date and building_date &lt; normative.end_date">
                                    <t t-if="answer.value == normative.name">
                                        <t t-set="selected_answers" t-value="selected_answers + [answer.value]"/>
                                    </t>
                                </t>
                            </t>
                        </t>

                        <t t-set="found_normative_filter" t-value="True"/>
                        <t t-set="selected_answers" t-value="[answer for answer in selected_answers if answer != '--']"/>

                        <t t-set="answer_count" t-value="len(selected_answers)"/>
                        <t t-set="i" t-value="0"/>
                        <t t-foreach="selected_answers" t-as="label">
                            <div t-att-style="'width:' + str(80 / answer_count) + '%; padding: 5px;' + ('border-right: 1px dashed #ccc;' if i &lt; answer_count - 1 else '')" t-esc="label"/>
                            <t t-set="i" t-value="i + 1"/>
                        </t>
                    </t>
                </t>

            </div>
            <div class="row" style="border: 1px solid #ccc; margin-top: -1px;">
                <div style="width: 50%;">
                    <span style="font-weight: bold;">Nº REGISTRO INSTALACIÓN:  </span>
                    <span t-field="o.installation_number"/>
                    <br />
                    <span style="font-weight: bold;">Nº EXPEDIENTE:  </span>
                    <span t-field="o.file_number"/>

                </div>
                <div style="width: 50%; border-left: 1px solid #ccc">
                    <span style="font-weight: bold;">FECHA PUESTA EN SERVICIO:  </span>
                    <t t-if="o.inspected_building_id.service_end_date">
                        <span t-field="o.inspected_building_id.service_end_date"/>
                    </t>
                    <t t-else="">
                        <span t-field="o.inspected_building_id.alternative_text"/>
                    </t>
                    <br />
                    <span style="font-weight: bold;">FECHA INICIO ACTIVIDAD:  </span>

                    <span t-field="o.inspected_building_id.service_start_date"/>

                </div>
            </div>

            <div class="row" style="border: 1px solid #ccc;margin-top: -1px;">
                <div style="width: 40%;">
                    <span style="font-weight: bold;">TIPO DE INSPECCION:  </span>
                    <span t-field="o.inspection_type"/>
                </div>
                <div style="width: 30%;border-left: 1px solid #ccc">
                    <span style="font-weight: bold;">FECHA:  </span>
                    <span t-field="o.inspection_start_date"/>
                    <span> al </span>
                    <span t-field="o.inspection_end_date"/>
                </div>
                <div style="width: 30%; border-left: 1px solid #ccc;">
                    <span style="font-weight: bold;">EQUIPOS:  </span>
                    <t t-foreach="o.equipment_ids" t-as="equipment">
                        <span t-field="equipment.equipment_id.name"/>
                    </t>
                </div>
            </div>

            <div class="row" style="border: 1px solid #ccc; margin-top: -1px;">
                <div style="width: 70%;border-right: 1px solid #ccc;">
                    <span style="font-weight: bold;">EMPRESA MANTENEDORA:  </span>
                    <span t-field="o.maintainer_id"/>
                </div>
                <div style="width: 30%;">
                    <span style="font-weight: bold;">EMI:  </span>
                    <span t-field="o.maintainer_emi"/>
                </div>
            </div>

        </div>


        <div class="container" style="border: 1px solid #ccc; margin-top: 5px;">
            <div style="width: 100%; font-weight: bold;">EQUIPOS Y SISTEMAS DE PROTECCIÓN CONTRA INCENDIOS DISPONIBLES EN ESTA INSTALACIÓN:  </div>
            <div class="row">
                <t t-set="equipment_records" t-value="request.env['installed.equipment'].search([])"/>
                <div t-att-style="'width: ' + str(100 / 3) + '%;'">
                    <ul class="list-unstyled">
                        <t t-foreach="equipment_records[:len(equipment_records) // 3]" t-as="equipment">
                            <li>
                                <t t-if="equipment in o.installed_equipment_ids">
                                    <strong>X</strong>
                                </t>
                                <t t-esc="equipment.name"/>
                            </li>
                        </t>
                    </ul>
                </div>
                <div t-att-style="'width: ' + str(100 / 3) + '%;'">
                    <ul class="list-unstyled">
                        <t t-foreach="equipment_records[len(equipment_records) // 3: 2 * len(equipment_records) // 3]" t-as="equipment">
                            <li>
                                <t t-if="equipment in o.installed_equipment_ids">
                                    <strong>X</strong>
                                </t>
                                <t t-esc="equipment.name"/>
                            </li>
                        </t>
                    </ul>
                </div>
                <div t-att-style="'width: ' + str(100 / 3) + '%;'">
                    <ul class="list-unstyled">
                        <t t-foreach="equipment_records[2 * len(equipment_records) // 3:]" t-as="equipment">
                            <li>
                                <t t-if="equipment in o.installed_equipment_ids">
                                    <strong>X</strong>
                                </t>
                                <t t-esc="equipment.name"/>
                            </li>
                        </t>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>
</odoo>